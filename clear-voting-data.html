<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Clear TASFA Voting Data</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        max-width: 600px;
        margin: 50px auto;
        padding: 20px;
        background-color: #f5f5f5;
      }
      .container {
        background: white;
        padding: 30px;
        border-radius: 10px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      }
      h1 {
        color: #333;
        text-align: center;
        margin-bottom: 30px;
      }
      .button {
        background-color: #dc3545;
        color: white;
        padding: 15px 30px;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        font-size: 16px;
        width: 100%;
        margin: 10px 0;
      }
      .button:hover {
        background-color: #c82333;
      }
      .success {
        background-color: #28a745;
      }
      .success:hover {
        background-color: #218838;
      }
      .info {
        background-color: #17a2b8;
        color: white;
        padding: 15px;
        border-radius: 5px;
        margin: 20px 0;
      }
      .log {
        background-color: #f8f9fa;
        border: 1px solid #dee2e6;
        border-radius: 5px;
        padding: 15px;
        margin: 20px 0;
        max-height: 300px;
        overflow-y: auto;
        font-family: monospace;
        font-size: 14px;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>üßπ Clear TASFA Voting Data</h1>

      <div class="info">
        <strong>What this does:</strong><br />
        ‚Ä¢ Clears all vote counts from localStorage<br />
        ‚Ä¢ Clears all voting timestamps<br />
        ‚Ä¢ Clears all voted category records<br />
        ‚Ä¢ Allows users to start voting fresh
      </div>

      <button class="button" onclick="clearAllVotingData()">
        üóëÔ∏è Clear All Frontend Voting Data
      </button>

      <button class="button success" onclick="checkVotingData()">
        üîç Check Current Voting Data
      </button>

      <div id="log" class="log" style="display: none"></div>
    </div>

    <script>
      function log(message) {
        const logDiv = document.getElementById("log");
        logDiv.style.display = "block";
        logDiv.innerHTML += message + "<br>";
        logDiv.scrollTop = logDiv.scrollHeight;
        console.log(message);
      }

      function clearAllVotingData() {
        log("üßπ Starting to clear all frontend voting data...");

        try {
          let votingStateCount = 0;
          let tasfaVoteCount = 0;

          // Clear all voting_state_ keys
          const votingStateKeys = [];
          for (let i = 0; i < localStorage.length; i++) {
            const key = localStorage.key(i);
            if (key && key.startsWith("voting_state_")) {
              votingStateKeys.push(key);
            }
          }

          votingStateKeys.forEach((key) => {
            localStorage.removeItem(key);
            votingStateCount++;
            log(`üóëÔ∏è Removed voting state: ${key}`);
          });

          // Clear all tasfa_vote_ keys
          const tasfaVoteKeys = [];
          for (let i = 0; i < localStorage.length; i++) {
            const key = localStorage.key(i);
            if (key && key.startsWith("tasfa_vote_")) {
              tasfaVoteKeys.push(key);
            }
          }

          tasfaVoteKeys.forEach((key) => {
            localStorage.removeItem(key);
            tasfaVoteCount++;
            log(`üóëÔ∏è Removed tasfa vote: ${key}`);
          });

          log(
            `‚úÖ Successfully cleared ${votingStateCount} voting state records`
          );
          log(`‚úÖ Successfully cleared ${tasfaVoteCount} tasfa vote records`);
          log("üéâ All frontend voting data cleared! Users can now vote fresh.");
          log("üìù Note: Backend data has already been cleared as mentioned.");
        } catch (error) {
          log(`‚ùå Error clearing voting data: ${error.message}`);
        }
      }

      function checkVotingData() {
        log("üîç Checking current voting data in localStorage...");

        try {
          let votingStateKeys = [];
          let tasfaVoteKeys = [];

          for (let i = 0; i < localStorage.length; i++) {
            const key = localStorage.key(i);
            if (key && key.startsWith("voting_state_")) {
              votingStateKeys.push(key);
            }
            if (key && key.startsWith("tasfa_vote_")) {
              tasfaVoteKeys.push(key);
            }
          }

          log(`üìä Found ${votingStateKeys.length} voting state records`);
          log(`üìä Found ${tasfaVoteKeys.length} tasfa vote records`);

          if (votingStateKeys.length === 0 && tasfaVoteKeys.length === 0) {
            log("‚úÖ No voting data found - localStorage is clean!");
          } else {
            log("üìã Voting state keys:");
            votingStateKeys.forEach((key) => log(`   - ${key}`));
            log("üìã Tasfa vote keys:");
            tasfaVoteKeys.forEach((key) => log(`   - ${key}`));
          }
        } catch (error) {
          log(`‚ùå Error checking voting data: ${error.message}`);
        }
      }
    </script>
  </body>
</html>

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Comprehensive Voting Data Clearer</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        max-width: 800px;
        margin: 50px auto;
        padding: 20px;
        background-color: #f5f5f5;
      }
      .container {
        background: white;
        padding: 30px;
        border-radius: 10px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      }
      h1 {
        color: #333;
        text-align: center;
        margin-bottom: 30px;
      }
      .button {
        background-color: #dc3545;
        color: white;
        padding: 15px 30px;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        font-size: 16px;
        width: 100%;
        margin: 10px 0;
      }
      .button:hover {
        background-color: #c82333;
      }
      .info {
        background-color: #17a2b8;
        color: white;
        padding: 15px;
        border-radius: 5px;
        margin: 20px 0;
      }
      .log {
        background-color: #f8f9fa;
        border: 1px solid #dee2e6;
        border-radius: 5px;
        padding: 15px;
        margin: 20px 0;
        max-height: 400px;
        overflow-y: auto;
        font-family: monospace;
        font-size: 14px;
        white-space: pre-wrap;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>üßπ Comprehensive Voting Data Clearer</h1>

      <div class="info">
        <strong>This will clear ALL voting-related data:</strong><br />
        ‚Ä¢ voting_state_* (voting state data)<br />
        ‚Ä¢ tasfa_vote_* (voting records)<br />
        ‚Ä¢ Any key containing "vote", "voting", or "tasfa"<br />
        ‚Ä¢ Any data with votingStatus, participants, or category fields
      </div>

      <button class="button" onclick="comprehensiveClear()">
        üóëÔ∏è Clear ALL Voting Data (Comprehensive)
      </button>

      <div id="log" class="log" style="display: none"></div>
    </div>

    <script>
      function log(message) {
        const logDiv = document.getElementById("log");
        logDiv.style.display = "block";
        logDiv.innerHTML += message + "\n";
        logDiv.scrollTop = logDiv.scrollHeight;
        console.log(message);
      }

      function comprehensiveClear() {
        log("üßπ Starting comprehensive voting data clear...\n");

        try {
          let totalCleared = 0;
          const clearedKeys = [];

          // Get all localStorage keys
          const allKeys = [];
          for (let i = 0; i < localStorage.length; i++) {
            const key = localStorage.key(i);
            if (key) {
              allKeys.push(key);
            }
          }

          log(`üìä Found ${allKeys.length} total localStorage items\n`);

          // Clear keys by prefix
          allKeys.forEach((key) => {
            let shouldClear = false;
            let reason = "";

            // Check for known voting prefixes
            if (key.startsWith("voting_state_")) {
              shouldClear = true;
              reason = "voting_state_ prefix";
            } else if (key.startsWith("tasfa_vote_")) {
              shouldClear = true;
              reason = "tasfa_vote_ prefix";
            } else if (
              key.toLowerCase().includes("vote") ||
              key.toLowerCase().includes("voting") ||
              key.toLowerCase().includes("tasfa")
            ) {
              shouldClear = true;
              reason = "contains vote/voting/tasfa";
            } else {
              // Check the actual data content
              try {
                const value = localStorage.getItem(key);
                if (value) {
                  const parsed = JSON.parse(value);

                  // Check if it contains voting-related data
                  if (parsed && typeof parsed === "object") {
                    const hasVotingData =
                      parsed.votingStatus !== undefined ||
                      parsed.participants !== undefined ||
                      parsed.category !== undefined ||
                      parsed.timestamp !== undefined ||
                      parsed.canVote !== undefined ||
                      parsed.pendingCategories !== undefined ||
                      parsed.voteTimestamps !== undefined ||
                      parsed.votedCategories !== undefined;

                    if (hasVotingData) {
                      shouldClear = true;
                      reason = "contains voting data structure";
                    }
                  }
                }
              } catch (e) {
                // If JSON parsing fails, check if it's a string containing voting keywords
                const value = localStorage.getItem(key);
                if (
                  value &&
                  typeof value === "string" &&
                  (value.toLowerCase().includes("vote") ||
                    value.toLowerCase().includes("voting") ||
                    value.toLowerCase().includes("tasfa"))
                ) {
                  shouldClear = true;
                  reason = "string contains voting keywords";
                }
              }
            }

            if (shouldClear) {
              localStorage.removeItem(key);
              totalCleared++;
              clearedKeys.push({ key, reason });
              log(`üóëÔ∏è Removed: ${key} (${reason})`);
            }
          });

          log(`\n‚úÖ COMPREHENSIVE CLEAR COMPLETE!`);
          log(`üìä Total items cleared: ${totalCleared}`);
          log(`üìä Items remaining: ${localStorage.length}`);

          if (totalCleared > 0) {
            log(`\nüìã Cleared items:`);
            clearedKeys.forEach((item) => {
              log(`   - ${item.key} (${item.reason})`);
            });
          }

          log(
            "\nüéâ All voting data has been cleared! Users can now vote fresh."
          );
        } catch (error) {
          log(`‚ùå Error during comprehensive clear: ${error.message}`);
        }
      }
    </script>
  </body>
</html>
